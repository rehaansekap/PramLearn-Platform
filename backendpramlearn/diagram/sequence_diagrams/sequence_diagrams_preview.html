
<!DOCTYPE html>
<html>
<head>
    <title>PramLearn ARCS Clustering - Sequence Diagrams</title>
    <script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            margin: 20px; 
            background-color: #f5f5f5;
        }
        .diagram-container { 
            background: white; 
            margin: 30px 0; 
            padding: 20px; 
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        .folder-header {
            background: linear-gradient(135deg, #11418b, #1a5bb8);
            color: white;
            padding: 15px 20px;
            margin: 40px 0 0 0;
            border-radius: 8px 8px 0 0;
            font-size: 18px;
            font-weight: bold;
        }
        .diagram-title { 
            color: #11418b; 
            border-bottom: 2px solid #11418b; 
            padding-bottom: 10px;
            margin-bottom: 20px;
            font-size: 16px;
        }
        .mermaid { 
            text-align: center; 
            background: white;
            margin: 20px 0;
        }
        .header {
            text-align: center;
            color: #11418b;
            margin-bottom: 30px;
        }
        .timestamp {
            color: #666;
            font-size: 14px;
            text-align: right;
            margin-top: 20px;
        }
        .folder-section {
            margin-bottom: 50px;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>🔄 PramLearn ARCS Clustering System</h1>
        <h2>Sequence Diagrams - Organized Structure</h2>
        <p>Generated automatically from codebase analysis</p>
    </div>

    <div class="folder-section">
        <div class="folder-header">
            📁 Student Flow
        </div>

        <div class="diagram-container">
            <h3 class="diagram-title">📄 Arcs Questionnaire Flow</h3>
            <div class="mermaid">

sequenceDiagram
    participant S as Student
    participant F as Frontend (React)
    participant B as Backend API
    participant DB as Database
    
    Note over S,DB: ARCS Questionnaire Flow
    
    S->>+F: Login sebagai student
    F->>+B: POST /api/auth/login/
    B-->>-F: Authentication token
    F-->>-S: Dashboard siswa
    
    S->>+F: Akses material pembelajaran
    F->>+B: GET /api/materials/{slug}/
    B-->>-F: Material data + ARCS questionnaire
    F-->>-S: Tampilan material
    
    S->>+F: Klik "Isi Kuesioner ARCS"
    F->>+B: GET /api/arcs/questionnaire/{id}/
    B->>+DB: Ambil pertanyaan ARCS
    DB-->>-B: 20 pertanyaan (4 dimensi)
    B-->>-F: Struktur kuesioner
    F-->>-S: Form kuesioner (20 pertanyaan)
    
    loop Untuk setiap pertanyaan (1-20)
        S->>F: Jawab pertanyaan (skala 1-5)
        F->>F: Simpan di state lokal
    end
    
    S->>+F: Submit kuesioner lengkap
    F->>+B: POST /api/student/arcs/submit/
    B->>+DB: Simpan ARCSResponse & ARCSAnswer
    DB-->>-B: Data tersimpan
    B-->>-F: Submission berhasil
    F-->>-S: Konfirmasi pengiriman

            </div>
        </div>

        <div class="diagram-container">
            <h3 class="diagram-title">📄 Automatic Clustering Process</h3>
            <div class="mermaid">

sequenceDiagram
    participant B as Backend API
    participant ARCS as ARCSProcessor
    participant DB as Database
    participant KM as K-Means
    
    Note over B,KM: Automatic Clustering Process
    
    B->>+ARCS: _process_arcs_scores()
    ARCS->>+DB: Ambil semua data ARCS siswa
    DB-->>-ARCS: Dataset lengkap (Attention, Relevance, Confidence, Satisfaction)
    
    ARCS->>ARCS: Hitung rata-rata per dimensi
    ARCS->>+KM: fit_predict(features_scaled)
    KM->>KM: StandardScaler normalization
    KM->>KM: K-Means clustering (k=3)
    KM->>KM: Map clusters to motivation levels
    KM-->>-ARCS: cluster_labels (High/Medium/Low)
    
    ARCS->>+DB: Update StudentMotivationProfile
    DB-->>-ARCS: Profile updated
    ARCS-->>-B: Clustering selesai

            </div>
        </div>

        <div class="diagram-container">
            <h3 class="diagram-title">📄 View Results</h3>
            <div class="mermaid">

sequenceDiagram
    participant S as Student
    participant F as Frontend (React)
    participant B as Backend API
    participant DB as Database
    
    Note over S,DB: View Results
    
    S->>+F: Lihat hasil analisis ARCS
    F->>+B: GET /api/student/motivation-profile/
    B->>+DB: Ambil StudentMotivationProfile
    DB-->>-B: Profil motivasi + skor dimensi
    B-->>-F: Data analisis lengkap
    F-->>-S: Dashboard hasil ARCS
    
    S->>F: Lihat rekomendasi personal
    F->>F: Generate recommendations berdasarkan hasil
    F->>S: Tampilan insight & saran

            </div>
        </div>
    </div>

    <div class="folder-section">
        <div class="folder-header">
            📁 Teacher Flow
        </div>

        <div class="diagram-container">
            <h3 class="diagram-title">📄 Csv Upload Flow</h3>
            <div class="mermaid">

sequenceDiagram
    participant T as Teacher
    participant F as Frontend (React)
    participant B as Backend API
    participant CSV as CSV Processor
    participant KM as K-Means
    participant DB as Database
    
    Note over T,DB: CSV Upload Flow
    
    T->>+F: Login sebagai teacher
    F->>+B: POST /api/auth/login/
    B-->>-F: Authentication token
    F-->>-T: Dashboard guru
    
    T->>+F: Akses Class Management
    F->>+B: GET /api/teacher/classes/
    B-->>-F: Daftar kelas yang diajar
    F-->>-T: Pilihan kelas
    
    T->>+F: Klik tab "Upload ARCS Data"
    F-->>-T: Upload interface + template download
    
    T->>F: Download template CSV
    F->>T: File arcs_data.csv (template)
    
    T->>+F: Upload file CSV yang sudah diisi
    F->>+B: POST /api/upload-arcs-csv/
    B->>+CSV: sessions_assign_motivation_profiles()
    CSV->>CSV: Validasi format CSV
    CSV->>CSV: Hitung rata-rata per dimensi ARCS
    
    CSV->>+KM: KMeans clustering (k=3)
    KM->>KM: fit_predict(features)
    KM->>KM: Map clusters berdasarkan centroid
    KM-->>-CSV: cluster_labels
    
    CSV->>+DB: Batch update StudentMotivationProfile
    DB-->>-CSV: Profiles updated
    CSV-->>-B: Processing result
    B-->>-F: Success + statistics
    F-->>-T: Konfirmasi upload berhasil

            </div>
        </div>

        <div class="diagram-container">
            <h3 class="diagram-title">📄 Questionnaire Based Flow</h3>
            <div class="mermaid">

sequenceDiagram
    participant T as Teacher
    participant F as Frontend (React)
    participant B as Backend API
    participant ARCS as ARCSProcessor
    participant KM as K-Means
    participant DB as Database
    
    Note over T,DB: Questionnaire-based Flow
    
    T->>+F: Klik tab "ARCS Questionnaire"
    F->>+B: GET /api/arcs/responses/
    B->>+DB: Ambil responses siswa
    DB-->>-B: Data responses (34 siswa)
    B-->>-F: Statistics responses
    F-->>-T: Overview kuesioner
    
    T->>+F: Trigger clustering manual
    F->>+B: POST /api/arcs/trigger-clustering/
    B->>+ARCS: update_all_motivation_levels()
    ARCS->>+DB: Query semua StudentMotivationProfile
    DB-->>-ARCS: Dataset ARCS lengkap
    
    ARCS->>+KM: Perform clustering
    KM->>KM: StandardScaler + K-Means
    KM-->>-ARCS: Motivation levels
    
    ARCS->>+DB: Update motivation_level untuk semua siswa
    DB-->>-ARCS: Batch update selesai
    ARCS-->>-B: Clustering statistics
    B-->>-F: Results summary
    F-->>-T: Hasil clustering

            </div>
        </div>

        <div class="diagram-container">
            <h3 class="diagram-title">📄 Analysis Export</h3>
            <div class="mermaid">

sequenceDiagram
    participant T as Teacher
    participant F as Frontend (React)
    participant B as Backend API
    participant PDF as PDF Service
    participant DB as Database
    
    Note over T,DB: Analysis & Export
    
    T->>+F: Lihat hasil clustering
    F->>+B: GET /api/clustering/statistics/
    B->>+DB: Query StudentMotivationProfile grouped
    DB-->>-B: Distribution statistics
    B-->>-F: High: X, Medium: Y, Low: Z
    F-->>-T: Dashboard analytics
    
    T->>+F: Export laporan PDF
    F->>+B: POST /api/export/clustering-report/
    B->>+PDF: ARCSClusteringPDFService.generate()
    PDF->>+DB: Ambil data lengkap untuk laporan
    DB-->>-PDF: All student profiles + statistics
    PDF->>PDF: Generate comprehensive report
    PDF-->>-B: PDF file content
    B-->>-F: PDF download response
    F-->>-T: File laporan clustering.pdf

            </div>
        </div>

        <div class="diagram-container">
            <h3 class="diagram-title">📄 Group Formation Flow</h3>
            <div class="mermaid">

sequenceDiagram
    participant T as Teacher
    participant F as Frontend (React)
    participant B as Backend API
    participant DB as Database
    
    Note over T,DB: Group Formation Flow
    
    T->>+F: Lanjut ke pembentukan kelompok
    F->>+B: GET /api/groups/formation-page/
    B-->>-F: Group formation interface
    F-->>-T: Opsi pembentukan kelompok
    
    T->>+F: Generate Groups (Heterogen/Homogen)
    F->>+B: POST /api/teacher/auto-group-formation/
    B->>B: Validate motivation profiles
    B->>B: Execute genetic algorithm (DEAP)
    B->>+DB: Simpan kelompok optimal
    DB-->>-B: Groups created
    B-->>-F: Group formation results
    F-->>-T: Kelompok terbentuk berdasarkan clustering

            </div>
        </div>

        <div class="diagram-container">
            <h3 class="diagram-title">📄 05 Genetic Algorithm Group Formation</h3>
            <div class="mermaid">

sequenceDiagram
    participant T as Teacher
    participant F as Frontend (React)
    participant B as Backend API
    participant GA as Genetic Algorithm
    participant DB as Database
    
    Note over T,DB: Genetic Algorithm - Heterogeneous Group Formation
    
    T->>+F: Pilih "Heterogeneous Groups"
    F->>+B: POST /api/groups/genetic-formation/
    B->>+DB: Ambil StudentMotivationProfile
    DB-->>-B: Data siswa dengan motivation levels
    
    B->>+GA: initialize_population()
    GA->>GA: Create random group combinations
    GA-->>-B: Initial population
    
    loop Evolusi (Max 100 generasi)
        B->>+GA: evaluate_fitness()
        GA->>GA: Hitung diversity score per kelompok
        GA->>GA: Hitung balance score antar kelompok
        GA-->>-B: Fitness scores
        
        B->>+GA: selection_crossover_mutation()
        GA->>GA: Tournament selection
        GA->>GA: Crossover (swap students)
        GA->>GA: Mutation (random reassignment)
        GA-->>-B: New generation
        
        B->>B: Check convergence
    end
    
    B->>B: Pilih solusi terbaik
    B->>+DB: Simpan kelompok hasil GA
    DB-->>-B: Groups saved
    B-->>-F: Optimal group formation
    F-->>-T: Kelompok heterogen terbentuk

            </div>
        </div>
    </div>

    <div class="folder-section">
        <div class="folder-header">
            📁 Detail Algoritma K-Means Clustering
        </div>

        <div class="diagram-container">
            <h3 class="diagram-title">📄 Data Preparation</h3>
            <div class="mermaid">

sequenceDiagram
    participant API as API Endpoint
    participant ARCS as ARCSProcessor
    participant DB as Database
    
    Note over API,DB: Data Preparation
    
    API->>+ARCS: update_all_motivation_levels()
    
    ARCS->>+DB: Query StudentMotivationProfile
    Note right of DB: Filter: attention, relevance,<br/>confidence, satisfaction not null<br/>Exclude: semua nilai = 0.0
    DB-->>-ARCS: profiles (N siswa)
    
    ARCS->>ARCS: Validasi: len(profiles) >= n_clusters (3)
    
    loop Untuk setiap profile
        ARCS->>ARCS: features.append([attention, relevance, confidence, satisfaction])
        ARCS->>ARCS: profile_ids.append(profile.id)
    end
    
    ARCS->>ARCS: features = np.array(features)

            </div>
        </div>

        <div class="diagram-container">
            <h3 class="diagram-title">📄 Normalization Clustering</h3>
            <div class="mermaid">

sequenceDiagram
    participant ARCS as ARCSProcessor
    participant SC as StandardScaler
    participant KM as KMeans
    
    Note over ARCS,KM: Normalization & Clustering
    
    ARCS->>+SC: fit_transform(features)
    SC->>SC: Standardize: (X - mean) / std
    SC-->>-ARCS: features_scaled
    
    ARCS->>+KM: __init__(n_clusters=3, random_state=42, n_init=10)
    KM-->>-ARCS: KMeans object
    
    ARCS->>+KM: fit_predict(features_scaled)
    KM->>KM: Initialize centroids (k-means++)
    
    loop Max 300 iterations
        KM->>KM: Assign points to nearest centroid
        KM->>KM: Update centroids
        KM->>KM: Check convergence
    end
    
    KM-->>-ARCS: cluster_labels [0,1,2,...]
    
    ARCS->>+KM: cluster_centers_
    KM-->>-ARCS: centroids matrix
    
    ARCS->>ARCS: centroid_means = np.mean(centroids, axis=1)
    ARCS->>ARCS: sorted_indices = np.argsort(centroid_means)
    
    ARCS->>ARCS: level_mapping = {<br/>  sorted_indices[0]: "Low",<br/>  sorted_indices[1]: "Medium",<br/>  sorted_indices[2]: "High"<br/>}

            </div>
        </div>

        <div class="diagram-container">
            <h3 class="diagram-title">📄 Database Update</h3>
            <div class="mermaid">

sequenceDiagram
    participant ARCS as ARCSProcessor
    participant DB as Database
    participant API as API Endpoint
    
    Note over ARCS,API: Database Update
    
    ARCS->>+DB: transaction.atomic()
    
    loop Untuk setiap profile_id, cluster_label
        ARCS->>ARCS: motivation_level = level_mapping[cluster_label]
        ARCS->>DB: UPDATE StudentMotivationProfile<br/>SET motivation_level = motivation_level<br/>WHERE id = profile_id
    end
    
    DB-->>-ARCS: Batch update committed
    
    ARCS->>ARCS: Calculate return statistics
    ARCS-->>-API: {<br/>  "total_profiles": N,<br/>  "clusters": {<br/>    "Low": count_low,<br/>    "Medium": count_medium,<br/>    "High": count_high<br/>  }<br/>}

            </div>
        </div>
    </div>

    <div class="timestamp">
        Generated on: 2025-07-17 03:07:47
    </div>

    <script>
        mermaid.initialize({ 
            startOnLoad: true,
            theme: 'neutral',
            themeVariables: {
                primaryColor: '#11418b',
                primaryTextColor: '#fff',
                primaryBorderColor: '#11418b',
                lineColor: '#11418b'
            }
        });
    </script>
</body>
</html>
